---
작성일: "2023-08-10 23:32"
링크: https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=276041776
---
#개발서적 #대규모시스템설계기초
## 연결문서
- [[1장 사용자 수에 따른 규모 확장성]]

## 정리
메시지 큐는 메시지의 무손실을 보장하며, 비동기 방식을 지원하는 컴포넌트이다.  

![2020230814155826.png|500](./images/Pasted%20image%2020230814155826.png)

메시지 큐를 사용하면 서비스 또는 서버간 결합이 느슨해진다.  
서버간 결합이 느슨해지면 확장에 용이하고, 장애에 대한 대처가 또한 유연해진다. 물론 장점만 있는 것이 아니다 메시지 큐 또한 단일 장애 지점이 되지 않도록 다중화를 통한 가용성을 높여야 하며, 메시지의 정상적인 소비와 병목은 체크 등을 확인할 모니터링 전략까지 생각해야하기 때문이다.

이미지 보정 앱을 통해 메세지 큐 사용 방법을 예시로 들어보자

![2020230814155900.png|500](./images/Pasted%20image%2020230814155900.png)

이미지의 크로핑, 샤프닝, 브러링등을 지원하는 사진 보정 앱이 있다. 이미지 보정 작업은 오래 걸릴 수 있는 작업이기 때문에 비동기로 처리하는게 좋다. 게다가 CPU 집약적인 경우가 많기 때문에 따로 이미지 보정용 서버를 두어 작업을 처리하는 것이 안전하다.  
1. 이미지가 업로드 요청이 들어온다. 
2. 업로드에 성공하면 큐에 메시지(job)를 발행하고 응답한다.
3. 이미지 보정용 서버는 큐에서 메시지를 소비한다. 
4. 이미지를 가져와 보정작업을 수행한다.

또한 이미지 업로드 요청이 갑자기 늘어나는 경우 메시지를 소비하는 보정용 서버를 스케일 아웃하는 것으로 대응이 가능하다.  
이 처럼 메시지 큐를 사용하는 것으로 효율적인 서비스가 가능해진다. 
### 메세지 큐 아키텍처
메세지 큐의 기본 아키텍처는 생산자(producer) 또는 발행자(publisher)가 큐에 메세지를 넣으면  
소비자(consumer) 또는 구독자(subscriber)가 큐에서 메시지를 소비하는 전략이다.  
메세지 생성과 소비 과정이 비동기적으로 이루어지기 때문에 비동기 방식이라고 한다.